<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aiaxcart Premium Shop</title>

  <!-- CSS / Icons / Supabase -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --primary: #FFB0B5;
      --secondary: #FFD3D6;
      --dark: #382f2c;
      --light: #fefaf7;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--light);
      color: var(--dark);
    }

    .navbar-brand {
      font-weight: 700;
      color: var(--primary);
    }

    .card {
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      border: none;
      transition: transform 0.2s;
      margin-bottom: 1.5rem;
      background: white;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .category-tab {
      cursor: pointer;
      padding: 10px 20px;
      border-radius: 30px;
      margin: 0 5px;
      transition: all 0.3s;
      font-weight: 500;
      background: white;
      white-space: nowrap;
    }

    .category-tab.active {
      background-color: var(--primary);
      color: white;
    }

    .product-card {
      height: 100%;
    }

    .product-img {
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      color: var(--primary);
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      min-width: 300px;
    }

    .buyer-profile-img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background-color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.8rem;
      font-weight: bold;
      margin: 0 auto 15px;
    }

    .order-status {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .status-pending {
      background-color: #fff3cd;
      color: #856404;
    }

    .status-confirmed {
      background-color: #d1ecf1;
      color: #0c5460;
    }

    .status-delivered {
      background-color: #d4edda;
      color: #155724;
    }

    .status-cancelled {
      background-color: #f8d7da;
      color: #721c24;
    }

    .section {
      padding: 20px 0;
    }

    .hidden {
      display: none !important;
    }

    .modal-content {
      border-radius: 12px;
      border: none;
    }

    .modal-header {
      background-color: var(--primary);
      color: white;
      border-radius: 12px 12px 0 0;
    }

    .btn-primary {
      background-color: var(--primary);
      border-color: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: #ff9da3;
      border-color: #ff9da3;
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 0.25rem rgba(255, 176, 181, 0.25);
    }

    .feedback-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
    }

    .nav-link.active {
      background-color: var(--primary) !important;
      color: white !important;
      border-radius: 20px;
    }

    @media (max-width: 768px) {
      .category-tab {
        padding: 8px 15px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- Toasts -->
  <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

  <!-- Buyer Site -->
  <div id="buyerSite">
    <!-- Nav -->
    <nav class="navbar navbar-expand-lg navbar-light shadow-sm" style="background: #FFD3D6;">
      <div class="container">
        <a class="navbar-brand" href="#">
          <i class="fas fa-shopping-cart me-2"></i>Aiaxcart Premium Shop
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link active" href="#" data-section="home">Home</a>
            </li>
            <li class="nav-item">
              <!-- IMPORTANT: relative path for GitHub Pages -->
              <a class="nav-link" href="admin.html" target="_blank">Admin</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-section="rules">Rules</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-section="feedback">Feedback</a>
            </li>
          </ul>
          <div class="d-flex align-items-center">
            <div id="userAuth">
              <button class="btn btn-outline-primary me-2" id="loginBtn">Login</button>
              <button class="btn btn-primary" id="signupBtn">Sign Up</button>
            </div>
            <div id="userProfile" class="hidden">
              <div class="dropdown">
                <button class="btn btn-outline-primary dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                  <i class="fas fa-user me-1"></i> <span id="userName">User</span>
                </button>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="#" data-section="profile">My Account</a></li>
                  <li><a class="dropdown-item" href="#" data-section="orders">My Orders</a></li>
                  <li><a class="dropdown-item" href="#" data-section="report">Report Issue</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item text-danger" href="#" id="logoutBtn">Logout</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container my-4">
      <!-- HOME -->
      <div id="homeSection" class="section">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2>Premium Accounts</h2>
          <div class="d-flex overflow-auto pb-2">
            <div class="category-tab active" data-category="all">All</div>
            <div class="category-tab" data-category="entertainment">Entertainment</div>
            <div class="category-tab" data-category="streaming">Streaming</div>
            <div class="category-tab" data-category="educational">Educational</div>
            <div class="category-tab" data-category="editing">Editing</div>
            <div class="category-tab" data-category="ai">AI</div>
          </div>
        </div>

        <div id="productsContainer" class="row">
          <!-- product cards -->
        </div>
      </div>

      <!-- RULES -->
      <div id="rulesSection" class="section hidden">
        <h2 class="mb-4">Shop Rules</h2>
        <div id="rulesContainer"></div>
      </div>

      <!-- FEEDBACK -->
      <div id="feedbackSection" class="section hidden">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2>Customer Feedback</h2>
          <button class="btn btn-primary" id="addFeedbackBtn">
            <i class="fas fa-plus me-1"></i> Add Feedback
          </button>
        </div>

        <div class="row">
          <div class="col-md-8">
            <div id="feedbackList"></div>
          </div>
          <div class="col-md-4">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Submit Feedback</h5>
                <form id="feedbackForm">
                  <div class="mb-3">
                    <label class="form-label" for="feedbackName">Your Name</label>
                    <input type="text" id="feedbackName" class="form-control" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="feedbackText">Your Feedback</label>
                    <textarea id="feedbackText" class="form-control" rows="4" required></textarea>
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="feedbackImage">Image (Optional)</label>
                    <input type="file" id="feedbackImage" class="form-control" accept="image/*">
                  </div>
                  <button class="btn btn-primary w-100" type="submit">Submit Feedback</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PROFILE + ORDERS -->
      <div id="profileSection" class="section hidden">
        <h2 class="mb-4">My Account</h2>
        <div class="row">
          <div class="col-md-4">
            <div class="card">
              <div class="card-body text-center">
                <div class="buyer-profile-img" id="profileAvatar">JD</div>
                <h4 id="profileName">John Doe</h4>
                <p class="text-muted" id="profileEmail">john@example.com</p>
                <button class="btn btn-outline-primary btn-sm" type="button">Edit Profile</button>
              </div>
            </div>
          </div>
          <div class="col-md-8">
            <ul class="nav nav-tabs" id="profileTabs">
              <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#pendingOrders">Pending</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#confirmedOrders">Confirmed</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#deliveredAccounts">Delivered</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#orderHistory">History</a>
              </li>
            </ul>

            <div class="tab-content mt-3">
              <div class="tab-pane fade show active" id="pendingOrders">
                <div id="pendingOrdersList"></div>
              </div>
              <div class="tab-pane fade" id="confirmedOrders">
                <div id="confirmedOrdersList"></div>
              </div>
              <div class="tab-pane fade" id="deliveredAccounts">
                <div id="deliveredAccountsList"></div>
              </div>
              <div class="tab-pane fade" id="orderHistory">
                <div id="orderHistoryList"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- REPORT ISSUE -->
      <div id="reportSection" class="section hidden">
        <h2 class="mb-4">Report an Issue</h2>
        <div class="row">
          <div class="col-md-8">
            <div class="card">
              <div class="card-body">
                <form id="reportForm">
                  <div class="mb-3">
                    <label class="form-label" for="reportOrderId">Order ID</label>
                    <input type="text" id="reportOrderId" class="form-control" required>
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="reportProduct">Product Name</label>
                    <input type="text" id="reportProduct" class="form-control" placeholder="Optional">
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="reportIssue">Issue Description</label>
                    <textarea id="reportIssue" class="form-control" rows="4" required></textarea>
                  </div>
                  <div class="mb-3">
                    <label class="form-label" for="reportScreenshot">Screenshot (Optional)</label>
                    <input type="file" id="reportScreenshot" class="form-control" accept="image/*">
                  </div>
                  <button class="btn btn-primary" type="submit">Submit Report</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div> <!-- /container -->
  </div> <!-- /buyerSite -->

  <!-- PRODUCT MODAL -->
  <div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="productModalTitle">Product Details</h5>
          <button class="btn-close" type="button" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-md-6">
              <div class="product-img mb-3">
                <span id="productModalIcon">üì∫</span>
              </div>
              <h4 id="productModalName">Product Name</h4>
              <p class="text-muted" id="productModalDescription"></p>
              <div class="mb-3">
                <label class="form-label">Available Stock</label>
                <div class="fw-bold" id="availableStock">0</div>
              </div>
            </div>
            <div class="col-md-6">
              <form id="buyNowForm">
                <div class="mb-3">
                  <label class="form-label" for="accountType">Account Type</label>
                  <select id="accountType" class="form-select" required>
                    <option value="">Select account type</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label" for="duration">Duration</label>
                  <select id="duration" class="form-select" required>
                    <option value="">Select duration</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Price</label>
                  <div class="fw-bold fs-4 text-primary" id="productPrice">‚Ç±0.00</div>
                </div>
                <div class="mb-3 hidden" id="inviteEmailField">
                  <label class="form-label" for="gmail">Gmail Address</label>
                  <input type="email" id="gmail" class="form-control" placeholder="Enter valid Gmail address">
                </div>
                <button class="btn btn-primary w-100" id="checkoutBtn" type="submit">
                  Buy Now
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CHECKOUT MODAL -->
  <div class="modal fade" id="checkoutModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Checkout</h5>
          <button class="btn-close" type="button" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="checkoutForm">
            <div class="mb-3">
              <label class="form-label" for="paymentMethod">Payment Method</label>
              <select id="paymentMethod" class="form-select" required>
                <option value="">Select payment method</option>
                <option value="gcash">GCash - 09625544105 (SMM)</option>
                <option value="maya">Maya - 09298943629 (AF)</option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label" for="referenceNumber">Reference Number</label>
              <input type="text" id="referenceNumber" class="form-control" placeholder="Enter reference number">
            </div>
            <div class="mb-3">
              <label class="form-label" for="proofImage">Proof of Payment (Screenshot)</label>
              <input type="file" id="proofImage" class="form-control" accept="image/*">
            </div>
            <div class="alert alert-info">
              <small>After submitting, your order will be processed and you'll receive a confirmation.</small>
            </div>
            <button class="btn btn-primary w-100" type="submit">Submit Order</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- LOGIN MODAL -->
  <div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Login</h5>
          <button class="btn-close" type="button" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="loginForm">
            <div class="mb-3">
              <label class="form-label" for="loginEmail">Email</label>
              <input type="email" id="loginEmail" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label" for="loginPassword">Password</label>
              <input type="password" id="loginPassword" class="form-control" required>
            </div>
            <button class="btn btn-primary w-100" type="submit">Login</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- SIGNUP MODAL -->
  <div class="modal fade" id="signupModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Sign Up</h5>
          <button class="btn-close" type="button" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="signupForm">
            <div class="mb-3">
              <label class="form-label" for="signupName">Full Name</label>
              <input type="text" id="signupName" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label" for="signupEmail">Email</label>
              <input type="email" id="signupEmail" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label" for="signupPassword">Password</label>
              <input type="password" id="signupPassword" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label" for="confirmPassword">Confirm Password</label>
              <input type="password" id="confirmPassword" class="form-control" required>
            </div>
            <button class="btn btn-primary w-100" type="submit">Create Account</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ===== SUPABASE CONFIG =====
    const SUPABASE_URL = 'https://hnymqvkfmythdxtjqeam.supabase.co';
    const SUPABASE_ANON_KEY =
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhueW1xdmtmbXl0aGR4dGpxZWFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMjE3NTUsImV4cCI6MjA3ODY5Nzc1NX0.4ww5fKNnbhNzNrkJZLa466b6BsKE_yYMO2YH6-auFlI';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let currentUser = null;
    let currentProduct = null;
    let currentOrderDetails = null;

    const durationMap = {
      '7d': '7 Days',
      '14d': '14 Days',
      '1m': '1 Month',
      '2m': '2 Months',
      '3m': '3 Months',
      '4m': '4 Months',
      '5m': '5 Months',
      '6m': '6 Months',
      '8m': '8 Months',
      '10m': '10 Months',
      '12m': '12 Months',
      '24m': '24 Months',
      'nw': 'No Warranty',
      '3m w': '3 Months Warranty',
      '6m w': '6 Months Warranty',
      '12m w': '12 Months Warranty'
    };
// ===== PRODUCT LIST (STATIC) =====
    const PRODUCTS_DATA = [
      // Entertainment
      {
        id: 'netflix',
        name: 'Netflix Premium',
        category: 'entertainment',
        icon: 'üì∫',
        stock: 15,
        pricing: {
          'solo profile': { '1m': 160, '2m': 280, '3m': 435, '4m': 565, '6m': 850, '8m': 1090, '12m': 1500 },
          'shared profile': { '1m': 80, '2m': 145, '3m': 205, '4m': 270, '6m': 410, '8m': 520, '12m': 800 }
        }
      },
      {
        id: 'viu',
        name: 'Viu Premium',
        category: 'entertainment',
        icon: 'üé¨',
        stock: 8,
        pricing: {
          'solo account': { '1m': 70, '2m': 105, '3m': 145, '4m': 170, '6m': 205, '10m': 280, '12m': 310 },
          'shared account': { '1m': 30, '2m': 55, '3m': 75, '4m': 90, '6m': 120, '10m': 190, '12m': 220 }
        }
      },
      {
        id: 'viva-max',
        name: 'VIVAMAX VIVAONE',
        category: 'entertainment',
        icon: 'üé≠',
        stock: 15,
        pricing: {
          'solo account': { '1m': 110, '2m': 145, '3m': 170 },
          'shared account': { '1m': 65, '2m': 90, '3m': 120 }
        }
      },
      {
        id: 'wetv',
        name: 'WeTV',
        category: 'entertainment',
        icon: 'üì±',
        stock: 8,
        pricing: {
          'solo account': { '1m': 150 },
          'shared account': { '1m': 55, '2m': 95, '3m': 135 }
        }
      },
      {
        id: 'iwant-tfc',
        name: 'IWANT TFC',
        category: 'entertainment',
        icon: 'üì∫',
        stock: 8,
        pricing: {
          'solo account': { '1m': 145 },
          'shared account': { '1m': 50, '2m': 90, '3m': 125 }
        }
      },
      {
        id: 'crunchyroll',
        name: 'Crunchyroll',
        category: 'entertainment',
        icon: 'üéÆ',
        stock: 10,
        pricing: {
          'solo profile': { '1m': 75, '2m': 115, '3m': 160, '4m': 195 },
          'shared profile': { '1m': 35, '2m': 60, '3m': 90, '4m': 115 }
        }
      },
      {
        id: 'disney-plus',
        name: 'Disney+',
        category: 'entertainment',
        icon: 'ü¶Å',
        stock: 12,
        pricing: {
          'solo account': { '1m': 390 },
          'solo profile': { '1m': 160, '2m': 315, '4m': 630, '10m': 1480, '12m': 1700 },
          'shared profile': { '1m': 85, '2m': 165, '4m': 330, '10m': 720, '12m': 880 }
        }
      },
      {
        id: 'bilibili',
        name: 'Bilibili',
        category: 'entertainment',
        icon: 'üì∫',
        stock: 6,
        pricing: {
          'shared account': { '1m': 45, '2m': 75, '3m': 105 }
        }
      },
      {
        id: 'loklok',
        name: 'Loklok',
        category: 'entertainment',
        icon: 'üì±',
        stock: 7,
        pricing: {
          'solo account': { '1m': 150 },
          'shared account': { '1m': 65, '2m': 115, '3m': 170 }
        }
      },
      {
        id: 'iqiyi',
        name: 'iQiyi',
        category: 'entertainment',
        icon: 'üì∫',
        stock: 8,
        pricing: {
          'shared account': { '1m': 50, '2m': 90, '3m': 135 }
        }
      },
      {
        id: 'hbo-max',
        name: 'HBO Max',
        category: 'entertainment',
        icon: 'üìπ',
        stock: 10,
        pricing: {
          'solo account': { '1m': 240, '2m': 360, '3m': 480 },
          'solo profile': { '1m': 135, '2m': 240, '3m': 350 },
          'shared profile': { '1m': 70, '2m': 120, '3m': 170 }
        }
      },
      {
        id: 'amazon-prime',
        name: 'Amazon Prime',
        category: 'entertainment',
        icon: 'üõí',
        stock: 15,
        pricing: {
          'solo account': { '1m': 80, '2m': 110, '3m': 135, '4m': 160, '5m': 185, '6m': 210 },
          'solo profile': { '1m': 50, '2m': 80, '3m': 110, '4m': 135, '5m': 150, '6m': 170 },
          'shared profile': { '1m': 30, '2m': 50, '3m': 70, '4m': 80, '5m': 90, '6m': 100 }
        }
      },
      {
        id: 'youku',
        name: 'Youku',
        category: 'entertainment',
        icon: 'üì∫',
        stock: 6,
        pricing: {
          'solo account': { '1m': 125 },
          'shared account': { '1m': 50, '2m': 90, '3m': 125 }
        }
      },
      {
        id: 'nba-league-pass',
        name: 'NBA League Pass Premium',
        category: 'entertainment',
        icon: 'üèÄ',
        stock: 5,
        pricing: {
          'solo account': { '1m': 150 },
          'shared account': { '1m': 75 }
        }
      },

      // Streaming
      {
        id: 'youtube',
        name: 'YouTube Premium',
        category: 'streaming',
        icon: 'üìπ',
        stock: 20,
        pricing: {
          'famhead': { '1m': 70, '2m': 90, '3m': 125, '4m': 150, '5m': 175, '6m': 200 },
          'solo': { '1m': 45, '2m': 60, '3m': 85, '4m': 105, '5m': 125, '6m': 145 },
          'invite': { '1m': 20, '2m': 35, '3m': 50, '4m': 60, '5m': 70, '6m': 80 }
        }
      },
      {
        id: 'spotify',
        name: 'Spotify Premium',
        category: 'streaming',
        icon: 'üéµ',
        stock: 15,
        pricing: {
          'solo fw': { '1m': 60, '2m': 110, '3m': 150, '4m': 200 },
          'solo nw': { '1m': 45, '2m': 80, '3m': 120, '4m': 150 }
        }
      },
      {
        id: 'apple-music',
        name: 'Apple Music',
        category: 'streaming',
        icon: 'üéß',
        stock: 12,
        pricing: {
          'solo account': { '1m': 49, '2m': 89, '3m': 129, '4m': 159 }
        }
      },

      // AI
      {
        id: 'chatgpt',
        name: 'ChatGPT Plus',
        category: 'ai',
        icon: 'üß†',
        stock: 10,
        pricing: {
          'solo account': { '1m': 600, '2m': 1050, '3m': 1500 },
          'shared account': { '1m': 120, '2m': 200, '3m': 290 }
        }
      },
      {
        id: 'blackbox-ai',
        name: 'Blackbox AI',
        category: 'ai',
        icon: 'ü§ñ',
        stock: 0,
        pricing: {
          'solo account': { '1m': 90, '2m': 170, '3m': 250 }
        }
      },
      {
        id: 'perplexity',
        name: 'Perplexity AI',
        category: 'ai',
        icon: 'üîç',
        stock: 8,
        pricing: {
          'solo account': { '1m': 120, '4m': 200, '6m': 250, '12m': 300, '24m': 450 },
          'shared account': { '1m': 55, '4m': 140, '6m': 190, '12m': 230, '24m': 350 }
        }
      },
      {
        id: 'google-one',
        name: 'Google One + Gemini AI',
        category: 'ai',
        icon: '‚òÅÔ∏è',
        stock: 10,
        pricing: {
          'solo account': { '1m': 50, '2m': 85, '3m': 120, '12m': 280 },
          'shared account': { '1m': 30, '2m': 50, '3m': 80, '12m': 150 }
        }
      },

      // Educational
      {
        id: 'quizlet',
        name: 'Quizlet+',
        category: 'educational',
        icon: 'üìö',
        stock: 6,
        pricing: {
          'solo account': { '1m': 45, '2m': 65, '3m': 100 },
          'shared account': { '1m': 20, '2m': 35, '3m': 50 }
        }
      },
      {
        id: 'scribd',
        name: 'Scribd Premium',
        category: 'educational',
        icon: 'üìñ',
        stock: 7,
        pricing: {
          'solo account': { '1m': 50, '2m': 85, '3m': 120 },
          'shared account': { '1m': 30, '2m': 50, '3m': 80 }
        }
      },
      {
        id: 'studocu',
        name: 'Studocu Premium',
        category: 'educational',
        icon: 'üéì',
        stock: 6,
        pricing: {
          'solo account': { '1m': 50, '2m': 85, '3m': 120 },
          'shared account': { '1m': 30, '2m': 50, '3m': 80 }
        }
      },
      {
        id: 'duolingo',
        name: 'Duolingo Super',
        category: 'educational',
        icon: 'üßë‚Äçüéì',
        stock: 6,
        pricing: {
          'solo account': { '1m': 80, '2m': 130, '3m': 170 }
        }
      },
      {
        id: 'turnitin-student',
        name: 'Turnitin Student',
        category: 'educational',
        icon: 'üìù',
        stock: 8,
        pricing: {
          'solo account': { '7d': 35, '14d': 50, '1m': 80, '2m': 140, '3m': 160, '6m': 330, '12m': 580 }
        }
      },
      {
        id: 'turnitin-instructor',
        name: 'Turnitin Instructor',
        category: 'educational',
        icon: 'üë®‚Äçüè´',
        stock: 5,
        pricing: {
          'solo account': { '1m': 520 },
          'shared account': { '7d': 120, '14d': 175, '1m': 280 }
        }
      },

      // Editing / Mixed
      {
        id: 'canva',
        name: 'Canva Pro',
        category: 'editing',
        icon: 'üé®',
        stock: 25,
        pricing: {
          'edu lifetime': { 'nw': 19, '3m w': 39, '6m w': 49, '12m w': 69 },
          'teamhead': { '1m': 45, '2m': 55, '3m': 65, '4m': 75, '5m': 85, '6m': 95 },
          'solo': { '1m': 25, '2m': 35, '3m': 45, '4m': 55, '5m': 65, '6m': 75 },
          'invite': { '1m': 10, '2m': 15, '3m': 20, '4m': 25, '5m': 30, '6m': 35 }
        }
      },
      {
        id: 'picsart',
        name: 'Picsart Gold',
        category: 'editing',
        icon: 'üëè',
        stock: 12,
        pricing: {
          'teamhead account': { '1m': 70, '2m': 115, '3m': 150 },
          'solo account': { '1m': 50, '2m': 85, '3m': 120 },
          'shared account': { '1m': 25, '2m': 45, '3m': 70 }
        }
      },
      {
        id: 'capcut',
        name: 'CapCut Pro',
        category: 'editing',
        icon: 'üìù',
        stock: 10,
        pricing: {
          'solo account': { '7d': 50, '1m': 130, '2m': 190, '3m': 240 },
          'shared account': { '1m': 70, '2m': 120, '3m': 155 }
        }
      },
      {
        id: 'alight-motion',
        name: 'Alight Motion Pro',
        category: 'editing',
        icon: 'üì±',
        stock: 8,
        pricing: {
          'solo account': { '1m': 90, '12m': 149 },
          'shared account': { '1m': 35, '12m': 69 }
        }
      },
      {
        id: 'remini',
        name: 'Remini Web',
        category: 'editing',
        icon: '‚ú®',
        stock: 6,
        pricing: {
          'solo account': { '7d': 30, '1m': 50 },
          'shared account': { '7d': 15, '1m': 25 }
        }
      },
      {
        id: 'grammarly',
        name: 'Grammarly Premium',
        category: 'educational',
        icon: '‚úçÔ∏è',
        stock: 8,
        pricing: {
          'solo account': { '1m': 85 },
          'shared account': { '1m': 35, '2m': 65, '3m': 95 }
        }
      },
      {
        id: 'quillbot',
        name: 'Quillbot Premium',
        category: 'educational',
        icon: 'üìù',
        stock: 8,
        pricing: {
          'solo account': { '1m': 100 },
          'shared account': { '1m': 45, '2m': 75, '3m': 110 }
        }
      },
      {
        id: 'ms-365',
        name: 'Microsoft 365',
        category: 'educational',
        icon: 'üíª',
        stock: 15,
        pricing: {
          'solo account': { '1m': 55, '2m': 90, '3m': 120 },
          'shared account': { '1m': 25, '2m': 45, '3m': 65 }
        }
      },
      {
        id: 'cams-canner',
        name: 'CamScanner Pro',
        category: 'editing',
        icon: 'üìÅ',
        stock: 8,
        pricing: {
          'solo account': { '1m': 100, '2m': 180, '3m': 250 },
          'shared account': { '1m': 50, '2m': 90, '3m': 120 }
        }
      },
      {
        id: 'small-pdf',
        name: 'Small PDF Pro',
        category: 'editing',
        icon: 'üìÅ',
        stock: 7,
        pricing: {
          'solo account': { '1m': 55, '2m': 95, '3m': 130 },
          'shared account': { '1m': 30, '2m': 50, '3m': 70 }
        }
      },
      {
        id: 'zoom',
        name: 'Zoom Pro',
        category: 'educational',
        icon: 'üìΩÔ∏è',
        stock: 6,
        pricing: {
          'solo account': { '14d': 45, '1m': 70, '2m': 120, '3m': 160 }
        }
      }
    ];
// ===== UTILITIES =====
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      const bsType = type === 'error' ? 'danger' : type;
      toast.className = `toast align-items-center text-bg-${bsType} border-0`;
      toast.setAttribute('role', 'alert');
      toast.innerHTML = `
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      `;
      document.getElementById('toastContainer').appendChild(toast);
      const bsToast = new bootstrap.Toast(toast);
      bsToast.show();
      toast.addEventListener('hidden.bs.toast', () => toast.remove());
    }

    function getInitials(name) {
      return name
        .split(' ')
        .filter(Boolean)
        .map(part => part[0])
        .join('')
        .toUpperCase();
    }

    function formatDate(dateString) {
      const d = new Date(dateString);
      return d.toLocaleDateString() + ' ' + d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    function isValidGmail(email) {
      return /^[a-zA-Z0-9.]+@gmail\.com$/.test(email);
    }

    function generateOrderId() {
      const now = new Date();
      const y = now.getFullYear();
      const m = String(now.getMonth() + 1).padStart(2, '0');
      const d = String(now.getDate()).padStart(2, '0');
      const rand = Math.floor(1000 + Math.random() * 9000);
      return `AXP-${y}${m}${d}-${rand}`;
    }

    // ===== SUPABASE FUNCTIONS =====
    async function saveBuyerToSupabase(buyer) {
      try {
        const { data, error } = await supabase.from('buyers').insert([buyer]);
        if (error) {
          console.error('Error saving buyer:', error);
        }
        return data;
      } catch (e) {
        console.error('saveBuyerToSupabase exception:', e);
      }
    }

    async function saveOrderToSupabase(order) {
      try {
        const { data, error } = await supabase.from('orders').insert([order]);
        if (error) {
          console.error('Error saving order:', error);
          showToast('Error saving order to database', 'error');
          return null;
        }
        showToast('Order saved to database!', 'success');
        return data;
      } catch (e) {
        console.error('saveOrderToSupabase exception:', e);
        showToast('Error saving order to database', 'error');
      }
    }

    async function sendTelegramNotification(order) {
      // Placeholder lang (no actual call)
      const message = `
üõí NEW ORDER RECEIVED!
Order ID: ${order.id}
Buyer: ${currentUser?.email || 'Unknown'}
Product: ${currentOrderDetails?.productName}
Account Type: ${order.account_type}
Duration: ${order.duration}
Price: ‚Ç±${order.price}
Payment Method: ${order.payment_method}
      `;
      console.log('[Telegram mock]', message);
    }

    // ===== UI: NAV & SECTIONS =====
    function showSection(sectionKey) {
      const id = sectionKey.endsWith('Section') ? sectionKey : `${sectionKey}Section`;
      document.querySelectorAll('.section').forEach(sec => sec.classList.add('hidden'));
      const target = document.getElementById(id);
      if (target) target.classList.remove('hidden');

      document.querySelectorAll('.nav-link[data-section]').forEach(a => a.classList.remove('active'));
      const nav = document.querySelector(`.nav-link[data-section="${sectionKey.replace('Section', '')}"]`);
      if (nav) nav.classList.add('active');
    }

    function showUserAuth() {
      document.getElementById('userAuth').classList.remove('hidden');
      document.getElementById('userProfile').classList.add('hidden');
    }

    function showUserProfile() {
      document.getElementById('userAuth').classList.add('hidden');
      document.getElementById('userProfile').classList.remove('hidden');
      document.getElementById('userName').textContent = currentUser.name;
      document.getElementById('profileName').textContent = currentUser.name;
      document.getElementById('profileEmail').textContent = currentUser.email;
      document.getElementById('profileAvatar').textContent = getInitials(currentUser.name);
      // Load user data from Supabase
    loadUserOrders();
    loadDeliveredAccounts();
}
    // ===== PRODUCTS (BUYER SITE) =====
    function loadProducts() {
      displayProducts(PRODUCTS_DATA);
    }

    function displayProducts(products) {
      const container = document.getElementById('productsContainer');
      container.innerHTML = '';

      products.forEach(product => {
        let minPrice = Infinity;
        Object.values(product.pricing).forEach(tier => {
          Object.values(tier).forEach(price => {
            if (price < minPrice) minPrice = price;
          });
        });
        if (!Number.isFinite(minPrice)) minPrice = 0;

        const col = document.createElement('div');
        col.className = 'col-6 col-md-4 col-lg-3 mb-4';
        col.innerHTML = `
          <div class="card product-card" data-product-id="${product.id}" data-category="${product.category}">
            <div class="card-body text-center">
              <div class="product-img mb-3">
                <span style="font-size: 2.5rem;">${product.icon}</span>
              </div>
              <h6 class="card-title mb-1">${product.name}</h6>
              <p class="card-text text-muted small mb-2 text-capitalize">${product.category}</p>
              <div class="d-flex justify-content-between align-items-center mb-1">
                <span class="badge bg-secondary text-capitalize">${product.category}</span>
                <span class="text-primary fw-bold small">From ‚Ç±${minPrice}</span>
              </div>
              <small class="text-muted d-block mb-2">Stock: ${product.stock}</small>
              <button class="btn btn-primary btn-sm w-100 view-product-btn" ${product.stock === 0 ? 'disabled' : ''}>
                ${product.stock === 0 ? 'Out of Stock' : 'View Details'}
              </button>
            </div>
          </div>
        `;
        container.appendChild(col);
      });

      document.querySelectorAll('.view-product-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const card = btn.closest('.product-card');
          const id = card.getAttribute('data-product-id');
          openProductModal(id);
        });
      });
    }

    function filterProducts(category) {
      const cards = document.querySelectorAll('.product-card');
      cards.forEach(card => {
        const c = card.getAttribute('data-category');
        if (category === 'all' || category === '' || !category) {
          card.style.display = '';
        } else {
          card.style.display = c === category ? '' : 'none';
        }
      });
    }

    function openProductModal(productId) {
      const product = PRODUCTS_DATA.find(p => p.id === productId);
      if (!product) {
        showToast('Product not found', 'error');
        return;
      }

      currentProduct = product;

      document.getElementById('productModalTitle').textContent = product.name;
      document.getElementById('productModalIcon').textContent = product.icon;
      document.getElementById('productModalName').textContent = product.name;
      document.getElementById('productModalDescription').textContent =
        `${product.category} ‚Ä¢ ${product.stock} in stock`;
      document.getElementById('availableStock').textContent = product.stock;
      document.getElementById('productPrice').textContent = '‚Ç±0.00';
      document.getElementById('buyNowForm').reset();

      const inviteField = document.getElementById('inviteEmailField');
      inviteField.classList.add('hidden');

      const accountTypeSelect = document.getElementById('accountType');
      const durationSelect = document.getElementById('duration');
      accountTypeSelect.innerHTML = '<option value="">Select account type</option>';
      durationSelect.innerHTML = '<option value="">Select duration</option>';

      Object.keys(product.pricing).forEach(typeKey => {
        const opt = document.createElement('option');
        opt.value = typeKey;
        opt.textContent = typeKey;
        accountTypeSelect.appendChild(opt);
      });

      accountTypeSelect.onchange = () => {
        const type = accountTypeSelect.value;
        durationSelect.innerHTML = '<option value="">Select duration</option>';
        if (type && product.pricing[type]) {
          Object.keys(product.pricing[type]).forEach(dKey => {
            const opt = document.createElement('option');
            opt.value = dKey;
            opt.textContent = durationMap[dKey] || dKey;
            durationSelect.appendChild(opt);
          });
        }
        updateInviteField();
        updatePrice();
      };

      durationSelect.onchange = () => {
        updatePrice();
      };

      const buyNowForm = document.getElementById('buyNowForm');
      buyNowForm.onsubmit = (e) => {
        e.preventDefault();
        handleBuyNow();
      };

      const productModal = new bootstrap.Modal(document.getElementById('productModal'));
      productModal.show();
    }

    function updateInviteField() {
      const type = document.getElementById('accountType').value || '';
      const inviteField = document.getElementById('inviteEmailField');
      if (type.toLowerCase().includes('invite')) {
        inviteField.classList.remove('hidden');
      } else {
        inviteField.classList.add('hidden');
      }
    }

    function updatePrice() {
      const type = document.getElementById('accountType').value;
      const duration = document.getElementById('duration').value;
      if (currentProduct && type && duration && currentProduct.pricing[type]) {
        const price = currentProduct.pricing[type][duration];
        if (price != null) {
          document.getElementById('productPrice').textContent = `‚Ç±${price}`;
          return;
        }
      }
      document.getElementById('productPrice').textContent = '‚Ç±0.00';
    }

    function handleBuyNow() {
      if (!currentUser) {
        showToast('Please login to continue', 'warning');
        const modal = new bootstrap.Modal(document.getElementById('loginModal'));
        modal.show();
        return;
      }

      const type = document.getElementById('accountType').value;
      const duration = document.getElementById('duration').value;
      if (!type || !duration) {
        showToast('Please select account type and duration', 'warning');
        return;
      }

      let inviteEmail = null;
      if (type.toLowerCase().includes('invite')) {
        inviteEmail = document.getElementById('gmail').value.trim();
        if (!inviteEmail || !isValidGmail(inviteEmail)) {
          showToast('Please enter a valid Gmail address', 'warning');
          return;
        }
      }

      const priceText = document.getElementById('productPrice').textContent;
      const price = Number(priceText.replace('‚Ç±', '')) || 0;

      currentOrderDetails = {
        productId: currentProduct.id,
        productName: currentProduct.name,
        accountType: type,
        duration,
        price,
        inviteEmail
      };

      bootstrap.Modal.getInstance(document.getElementById('productModal')).hide();
      const checkoutModal = new bootstrap.Modal(document.getElementById('checkoutModal'));
      checkoutModal.show();
    }

    async function handleCheckout(e) {
      e.preventDefault();
      if (!currentUser || !currentOrderDetails) {
        showToast('Missing order details.', 'error');
        return;
      }

      const paymentMethod = document.getElementById('paymentMethod').value;
      const referenceNumber = document.getElementById('referenceNumber').value.trim();
      // const proofImage = document.getElementById('proofImage').files[0]; // future use

      if (!paymentMethod) {
        showToast('Please select a payment method', 'warning');
        return;
      }

      const orderId = generateOrderId();
      const order = {
        id: orderId,
        buyer_id: currentUser.id,
        buyer_email: currentUser.email,
        product_id: currentOrderDetails.productId,
        account_type: currentOrderDetails.accountType,
        duration: currentOrderDetails.duration,
        price: currentOrderDetails.price,
        payment_method: paymentMethod,
        reference_number: referenceNumber || null,
        invite_email: currentOrderDetails.inviteEmail,
        status: 'pending',
        created_at: new Date().toISOString()
      };

      await saveOrderToSupabase(order);
      await sendTelegramNotification(order);

      bootstrap.Modal.getInstance(document.getElementById('checkoutModal')).hide();
      document.getElementById('checkoutForm').reset();
      showToast(`Order submitted! Your order ID is ${orderId}`, 'success');

      loadUserOrders();
            }
      // ===== RULES & FEEDBACK (MOCK) =====
    function loadRules() {
      const rules = [
        { id: 1, rule_text: 'All accounts are guaranteed for the duration purchased.' },
        { id: 2, rule_text: 'Refunds only if the account does not work within 24 hours.' },
        { id: 3, rule_text: 'Sharing account details with others may result in suspension.' }
      ];
      const container = document.getElementById('rulesContainer');
      container.innerHTML = `
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">General Rules</h5>
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              ${rules.map(r => `<li class="list-group-item">${r.rule_text}</li>`).join('')}
            </ul>
          </div>
        </div>
      `;
    }

    function loadFeedback() {
      const feedback = [
        { id: 1, buyer_name: 'John D.', feedback_text: 'Great service! My account works perfectly.', photo_url: null, created_at: '2023-05-15T10:30:00Z' },
        { id: 2, buyer_name: 'Sarah M.', feedback_text: 'Fast delivery and good support.', photo_url: null, created_at: '2023-05-10T14:22:00Z' },
        { id: 3, buyer_name: 'Mike T.', feedback_text: 'Had an issue but support fixed it quickly.', photo_url: null, created_at: '2023-05-05T09:15:00Z' }
      ];
      const container = document.getElementById('feedbackList');
      container.innerHTML = '';
      feedback.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card mb-3';
        card.innerHTML = `
          <div class="card-body">
            <div class="d-flex">
              <div class="feedback-avatar me-3">${getInitials(item.buyer_name)}</div>
              <div class="flex-grow-1">
                <h6 class="mb-1">${item.buyer_name}</h6>
                <p class="mb-2">${item.feedback_text}</p>
                ${item.photo_url ? `<img src="${item.photo_url}" class="img-fluid rounded mb-2" style="max-height:200px;">` : ''}
                <small class="text-muted">${formatDate(item.created_at)}</small>
              </div>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function submitFeedback(e) {
      e.preventDefault();
      const name = document.getElementById('feedbackName').value.trim();
      const text = document.getElementById('feedbackText').value.trim();
      if (!name || !text) {
        showToast('Please fill in all required fields', 'warning');
        return;
      }
      showToast('Feedback submitted! (mock only)', 'success');
      document.getElementById('feedbackForm').reset();
      loadFeedback();
    }

    // ===== ORDERS (PROFILE) ‚Äì MOCK DISPLAY =====
    function loadUserOrders() {
      // For now, mock lang para may laman UI
      const orders = [
        { id: 'AXP-20251115-1234', product_name: 'Netflix Premium', account_type: 'shared profile', duration: '1m', price: 80, status: 'pending', created_at: '2025-11-15T10:30:00Z' },
        { id: 'AXP-20251110-5678', product_name: 'Spotify Premium', account_type: 'solo fw', duration: '3m', price: 150, status: 'confirmed', created_at: '2025-11-10T08:00:00Z' },
        { id: 'AXP-20251101-9876', product_name: 'Canva Pro', account_type: 'invite', duration: '1m', price: 10, status: 'delivered', created_at: '2025-11-01T20:00:00Z' }
      ];
      displayUserOrders(orders);
    }

    function displayUserOrders(orders) {
      const pending = document.getElementById('pendingOrdersList');
      const confirmed = document.getElementById('confirmedOrdersList');
      const delivered = document.getElementById('deliveredAccountsList');
      const history = document.getElementById('orderHistoryList');

      pending.innerHTML = '';
      confirmed.innerHTML = '';
      delivered.innerHTML = '';
      history.innerHTML = '';

      orders.forEach(order => {
        const card = document.createElement('div');
        card.className = 'card mb-3';
        card.innerHTML = `
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="mb-1">${order.product_name}</h6>
                <p class="mb-1 small">Order ID: ${order.id}</p>
                <p class="mb-1 small">Account Type: ${order.account_type} ‚Ä¢ Duration: ${order.duration}</p>
                <p class="mb-0 fw-bold">‚Ç±${order.price}</p>
              </div>
              <div class="text-end">
                <span class="order-status status-${order.status} text-capitalize">${order.status}</span>
                <div class="mt-2">
                  <small class="text-muted">${formatDate(order.created_at)}</small>
                </div>
              </div>
            </div>
          </div>
        `;

        if (order.status === 'pending') pending.appendChild(card.cloneNode(true));
        if (order.status === 'confirmed') confirmed.appendChild(card.cloneNode(true));
        if (order.status === 'delivered') delivered.appendChild(card.cloneNode(true));
        history.appendChild(card);
      });
    }

    // ===== REPORT =====
    function submitReport(e) {
      e.preventDefault();
      const orderId = document.getElementById('reportOrderId').value.trim();
      const issue = document.getElementById('reportIssue').value.trim();
      if (!orderId || !issue) {
        showToast('Please fill in all required fields', 'warning');
        return;
      }
      showToast('Report submitted! (mock only)', 'success');
      document.getElementById('reportForm').reset();
      showSection('profile');
    }

    // ===== AUTH =====
    async function handleLogin(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value; // not used yet

      if (!email) {
        showToast('Please enter email', 'warning');
        return;
      }

      const user = {
        id: Date.now(),
        name: email.split('@')[0],
        email
      };

      currentUser = user;
      localStorage.setItem('aiaxcart_user', JSON.stringify(user));
      await saveBuyerToSupabase(user);
      showUserProfile();
      bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
      showToast('Login successful!', 'success');
    }

    async function handleSignup(e) {
      e.preventDefault();
      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;

      if (!name || !email) {
        showToast('Please fill in name and email', 'warning');
        return;
      }
      if (password !== confirmPassword) {
        showToast('Passwords do not match', 'error');
        return;
      }

      const user = {
        id: Date.now(),
        name,
        email
      };

      currentUser = user;
      localStorage.setItem('aiaxcart_user', JSON.stringify(user));
      await saveBuyerToSupabase(user);
      showUserProfile();
      bootstrap.Modal.getInstance(document.getElementById('signupModal')).hide();
      showToast('Account created!', 'success');
    }

    function handleLogout(e) {
      e.preventDefault();
      currentUser = null;
      localStorage.removeItem('aiaxcart_user');
      showUserAuth();
      showSection('home');
      showToast('Logged out.', 'success');
    }

    // ===== INIT =====
    function setupEventListeners() {
      // Nav sections (home/rules/feedback/profile/report)
      document.querySelectorAll('[data-section]').forEach(link => {
        link.addEventListener('click', e => {
          const section = link.getAttribute('data-section');
          // skip admin link
          if (section) {
            e.preventDefault();
            if (section === 'profile') showSection('profile');
            else if (section === 'rules') showSection('rules');
            else if (section === 'feedback') showSection('feedback');
            else if (section === 'report') showSection('report');
            else showSection('home');
          }
        });
      });

      // Category tabs
      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          const cat = tab.getAttribute('data-category');
          filterProducts(cat);
        });
      });

      // Auth buttons
      document.getElementById('loginBtn').addEventListener('click', () => {
        const modal = new bootstrap.Modal(document.getElementById('loginModal'));
        modal.show();
      });
      document.getElementById('signupBtn').addEventListener('click', () => {
        const modal = new bootstrap.Modal(document.getElementById('signupModal'));
        modal.show();
      });
      document.getElementById('logoutBtn').addEventListener('click', handleLogout);

      // Forms
      document.getElementById('loginForm').addEventListener('submit', handleLogin);
      document.getElementById('signupForm').addEventListener('submit', handleSignup);
      document.getElementById('checkoutForm').addEventListener('submit', handleCheckout);
      document.getElementById('feedbackForm').addEventListener('submit', submitFeedback);
      document.getElementById('reportForm').addEventListener('submit', submitReport);
    }

    function initializeApp() {
      const stored = localStorage.getItem('aiaxcart_user');
      if (stored) {
        try {
          currentUser = JSON.parse(stored);
          showUserProfile();
        } catch {
          showUserAuth();
        }
      } else {
        showUserAuth();
      }

      showSection('home');
      loadProducts();
      loadRules();
      loadFeedback();
    }

    document.addEventListener('DOMContentLoaded', () => {
      initializeApp();
      setupEventListeners();
    });


    // =========================
// SUPABASE HELPERS (REAL)
// =========================

// Save new buyer (used on SIGNUP only)
async function saveBuyerToSupabase(buyer) {
  try {
    const { data, error } = await supabase
      .from('buyers')
      .insert({
        id: buyer.id,        // email as ID
        name: buyer.name,
        email: buyer.email
      });

    if (error) {
      console.error('Error saving buyer:', error);
      return null;
    }
    return data;
  } catch (err) {
    console.error('saveBuyerToSupabase error:', err);
    return null;
  }
}

// Save order (used on CHECKOUT)
async function saveOrderToSupabase(order) {
  const { data, error } = await supabase.from('orders').insert(order);
  if (error) {
    console.error('Error saving order:', error);
    throw error;
  }
  return data;
}

// Load products from Supabase (optional, pwede mo nang burahin yung lumang version)
async function loadProductsFromSupabase() {
  const { data, error } = await supabase.from('products').select('*');
  if (error) {
    console.error('Error loading products:', error);
    showToast('Error loading products from database', 'error');
    return PRODUCTS_DATA; // fallback
  }
  return data;
}

// Override loadProducts to use Supabase first, then fallback to local PRODUCTS_DATA
async function loadProducts() {
  try {
    const supabaseProducts = await loadProductsFromSupabase();
    if (supabaseProducts && supabaseProducts.length > 0) {
      // NOTE: supabaseProducts structure dapat naka-match sa displayProducts needs
      displayProducts(supabaseProducts);
    } else {
      displayProducts(PRODUCTS_DATA);
    }
  } catch (error) {
    console.error('Error loading products:', error);
    showToast('Error loading products', 'error');
    displayProducts(PRODUCTS_DATA);
  }
}

// =========================
// LOAD USER ORDERS (REAL DATA)
// =========================
async function loadUserOrders() {
  if (!currentUser) return;

  try {
    const { data: orderRows, error } = await supabase
      .from('orders')
      .select('id, product_id, account_type, duration, price, status, created_at')
      .eq('buyer_id', currentUser.id)
      .order('created_at', { ascending: false });

    if (error) {
      console.error('Error loading user orders:', error);
      showToast('Error loading your orders', 'error');
      return;
    }

    if (!orderRows || !orderRows.length) {
      // clear lists
      displayUserOrders([]);
      return;
    }

    // Load product names for mapping
    const { data: productRows, error: prodErr } = await supabase
      .from('products')
      .select('id, name');

    const prodMap = {};
    if (!prodErr && Array.isArray(productRows)) {
      productRows.forEach((p) => {
        prodMap[p.id] = p.name;
      });
    }

    const orders = orderRows.map((o) => ({
      id: o.id,
      product_name: prodMap[o.product_id] || o.product_id,
      account_type: o.account_type,
      duration: o.duration,
      price: o.price,
      status: (o.status || 'pending').toLowerCase(),
      created_at: o.created_at
    }));

    displayUserOrders(orders);
  } catch (err) {
    console.error('loadUserOrders error:', err);
    showToast('Error loading your orders', 'error');
  }
}

// =========================
// LOAD DELIVERED ACCOUNTS (FROM records TABLE)
// =========================
async function loadDeliveredAccounts() {
  if (!currentUser) return;

  const container = document.getElementById('deliveredAccountsList');
  if (!container) return;

  container.innerHTML = '<p class="text-muted">Loading delivered accounts...</p>';

  try {
    const { data, error } = await supabase
      .from('records')
      .select(
        'id, order_id, product_name, account_type, duration, price, purchase_date, email, password, profile, pin'
      )
      .eq('buyer_id', currentUser.id)
      .order('purchase_date', { ascending: false });

    if (error) {
      console.error('Error loading delivered accounts:', error);
      showToast('Error loading delivered accounts', 'error');
      container.innerHTML = '<p class="text-muted">Failed to load delivered accounts.</p>';
      return;
    }

    if (!data || !data.length) {
      container.innerHTML = '<p class="text-muted">No delivered accounts yet.</p>';
      return;
    }

    container.innerHTML = '';
    data.forEach((rec) => {
      const card = document.createElement('div');
      card.className = 'card mb-3';
      card.innerHTML = `
        <div class="card-body">
          <h6 class="mb-1">${rec.product_name || 'Delivered Account'}</h6>
          <p class="mb-1 small">Order ID: ${rec.order_id || rec.id}</p>
          <p class="mb-1 small">Account Type: ${rec.account_type || '-'} ‚Ä¢ Duration: ${rec.duration || '-'}</p>
          <p class="mb-1 small">Account Email: <strong>${rec.email || '-'}</strong></p>
          <p class="mb-1 small">Password: <strong>${rec.password || '-'}</strong></p>
          ${rec.profile ? `<p class="mb-1 small">Profile: <strong>${rec.profile}</strong></p>` : ''}
          ${rec.pin ? `<p class="mb-1 small">PIN: <strong>${rec.pin}</strong></p>` : ''}
          <p class="mb-1 small">Purchase Date: ${
            rec.purchase_date ? formatDate(rec.purchase_date) : '-'
          }</p>
          <p class="mb-0 fw-bold">‚Ç±${rec.price ?? 0}</p>
        </div>
      `;
      container.appendChild(card);
    });
  } catch (err) {
    console.error('loadDeliveredAccounts error:', err);
    showToast('Error loading delivered accounts', 'error');
  }
}

// =========================
// LOGIN / SIGNUP (EMAIL AS ID)
// =========================
async function handleLogin() {
  const emailInput = document.getElementById('loginEmail');
  const passwordInput = document.getElementById('loginPassword');

  const email = emailInput.value.trim();
  const password = passwordInput.value; // hindi muna ginagamit

  if (!email) {
    showToast('Please enter your email', 'warning');
    return;
  }

  try {
    const normalizedEmail = email.toLowerCase();
    const name = normalizedEmail.split('@')[0];

    const user = {
      id: normalizedEmail, // IMPORTANT: ito yung buyer_id
      name: name,
      email: normalizedEmail
    };

    currentUser = user;
    localStorage.setItem('aiaxcart_user', JSON.stringify(user));

    showUserProfile();
    await loadUserOrders();
    await loadDeliveredAccounts();

    bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
    showToast('Login successful!', 'success');
  } catch (err) {
    console.error('Login error:', err);
    showToast('Login failed. Please try again.', 'error');
  }
}

async function handleSignup() {
  const nameInput = document.getElementById('signupName');
  const emailInput = document.getElementById('signupEmail');
  const passwordInput = document.getElementById('signupPassword');
  const confirmInput = document.getElementById('confirmPassword');

  const name = nameInput.value.trim();
  const email = emailInput.value.trim();
  const password = passwordInput.value;
  const confirmPassword = confirmInput.value;

  if (!name || !email) {
    showToast('Please fill in name and email', 'warning');
    return;
  }

  if (password !== confirmPassword) {
    showToast('Passwords do not match', 'error');
    return;
  }

  try {
    const normalizedEmail = email.toLowerCase();

    const user = {
      id: normalizedEmail, // email as ID
      name: name,
      email: normalizedEmail
    };

    // Save buyer in Supabase (buyers table)
    await saveBuyerToSupabase(user);

    currentUser = user;
    localStorage.setItem('aiaxcart_user', JSON.stringify(user));

    showUserProfile();
    await loadUserOrders();
    await loadDeliveredAccounts();

    bootstrap.Modal.getInstance(document.getElementById('signupModal')).hide();
    showToast('Account created successfully!', 'success');
  } catch (err) {
    console.error('Signup error:', err);
    showToast('Signup failed. Please try again.', 'error');
  }
}

// =========================
// CHECKOUT (SAVE REAL ORDER)
// =========================
async function handleCheckout() {
  if (!currentUser) {
    showToast('Please login first', 'warning');
    return;
  }

  const paymentMethod = document.getElementById('paymentMethod').value;
  const referenceNumber = document.getElementById('referenceNumber').value;
  const proofImage = document.getElementById('proofImage').files[0]; // currently not uploaded

  if (!paymentMethod) {
    showToast('Please select a payment method', 'warning');
    return;
  }

  if (!currentOrderDetails) {
    showToast('No product selected', 'error');
    return;
  }

  try {
    const orderId = generateOrderId();

    const order = {
      id: orderId,
      buyer_id: currentUser.id, // email
      product_id: currentOrderDetails.productId,
      account_type: currentOrderDetails.accountType,
      duration: currentOrderDetails.duration,
      price: currentOrderDetails.price,
      payment_method: paymentMethod,
      reference_number: referenceNumber || null,
      invite_email: currentOrderDetails.inviteEmail,
      status: 'pending',
      created_at: new Date().toISOString()
    };

    await saveOrderToSupabase(order);
    await sendTelegramNotification(order);

    bootstrap.Modal.getInstance(document.getElementById('checkoutModal')).hide();
    showToast(`Order submitted successfully! Your order ID is ${orderId}`, 'success');

    document.getElementById('checkoutForm').reset();

    await loadUserOrders();
  } catch (err) {
    console.error('Checkout error:', err);
    showToast('Error submitting order', 'error');
  }
}
  </script>
</body>
</html>
      
    
